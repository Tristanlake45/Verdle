<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>VERDLE - The Vern Eide Word Game</title>

  <!-- Mobile viewport so it scales properly on phones -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #121213;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      margin: 0;
      padding: 16px 0;
    }

    #game-container {
      width: 100%;
      max-width: 420px;
      padding: 0 12px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      letter-spacing: 0.2em;
      font-size: 28px;
      margin: 0 0 4px 0;
      text-align: center;
    }

    h2 {
      font-size: 14px;
      font-weight: 400;
      margin: 0 0 20px 0;
      opacity: 0.8;
      text-align: center;
    }

    #board {
      display: grid;
      grid-template-rows: repeat(6, 1fr);
      gap: 5px;
    }

    .row {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 5px;
      justify-items: center;
    }

    .tile {
      /* Responsive size: capped at 60px, shrinks on narrow screens */
      width: min(60px, 16vw);
      height: min(60px, 16vw);
      border: 2px solid #3a3a3c;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      font-weight: bold;
      text-transform: uppercase;
      box-sizing: border-box;
    }

    .tile.filled {
      border-color: #565758;
    }

    /* Correct letter in correct spot: powder blue */
    .tile.correct {
      background-color: #8ECDF8;
      border-color: #8ECDF8;
      color: #003049;
    }

    /* Correct letter in wrong spot: light orange */
    .tile.present {
      background-color: #FFC977;
      border-color: #FFC977;
      color: #3A2000;
    }

    .tile.absent {
      background-color: #3a3a3c;
      border-color: #3a3a3c;
      color: #fff;
    }

    #message {
      margin-top: 20px;
      min-height: 24px;
      text-align: center;
    }

    #controls {
      margin-top: 10px;
    }

    button {
      padding: 8px 16px;
      font-size: 14px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
    }

    /* Hidden input for mobile keyboard */
    #hiddenInput {
      position: absolute;
      opacity: 0;
      pointer-events: none;
      width: 1px;
      height: 1px;
      border: 0;
      padding: 0;
      margin: 0;
    }

    /* Slight size tweaks for very small screens */
    @media (max-width: 480px) {
      .tile {
        width: 14vw;
        height: 14vw;
        font-size: 24px;
      }

      h1 {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <div id="game-container">
    <h1>VERDLE</h1>
    <h2>The Vern Eide Word Game</h2>

    <div id="board">
      <!-- 6 rows Ã— 5 tiles -->
      <div class="row">
        <div class="tile" id="tile-0-0"></div>
        <div class="tile" id="tile-0-1"></div>
        <div class="tile" id="tile-0-2"></div>
        <div class="tile" id="tile-0-3"></div>
        <div class="tile" id="tile-0-4"></div>
      </div>
      <div class="row">
        <div class="tile" id="tile-1-0"></div>
        <div class="tile" id="tile-1-1"></div>
        <div class="tile" id="tile-1-2"></div>
        <div class="tile" id="tile-1-3"></div>
        <div class="tile" id="tile-1-4"></div>
      </div>
      <div class="row">
        <div class="tile" id="tile-2-0"></div>
        <div class="tile" id="tile-2-1"></div>
        <div class="tile" id="tile-2-2"></div>
        <div class="tile" id="tile-2-3"></div>
        <div class="tile" id="tile-2-4"></div>
      </div>
      <div class="row">
        <div class="tile" id="tile-3-0"></div>
        <div class="tile" id="tile-3-1"></div>
        <div class="tile" id="tile-3-2"></div>
        <div class="tile" id="tile-3-3"></div>
        <div class="tile" id="tile-3-4"></div>
      </div>
      <div class="row">
        <div class="tile" id="tile-4-0"></div>
        <div class="tile" id="tile-4-1"></div>
        <div class="tile" id="tile-4-2"></div>
        <div class="tile" id="tile-4-3"></div>
        <div class="tile" id="tile-4-4"></div>
      </div>
      <div class="row">
        <div class="tile" id="tile-5-0"></div>
        <div class="tile" id="tile-5-1"></div>
        <div class="tile" id="tile-5-2"></div>
        <div class="tile" id="tile-5-3"></div>
        <div class="tile" id="tile-5-4"></div>
      </div>
    </div>

    <div id="message"></div>
    <div id="controls">
      <button id="resetBtn">Play Again</button>
    </div>

    <!-- Hidden input to trigger mobile keyboard -->
    <input
      id="hiddenInput"
      type="text"
      inputmode="latin"
      autocomplete="off"
      autocorrect="off"
      autocapitalize="characters"
      spellcheck="false"
    />
  </div>

  <script>
    const WORD_LENGTH = 5;
    const MAX_GUESSES = 6;

    const VERN_EIDE_WORDS = [
      "DRIVE","BRAKE","RIDES","MOTOR","GEARS","ALIGN","SPEED","QUICK","TOTAL","SPORT",
      "COUPE","SEDAN","TRUCK","AXLES","CABIN","PANEL","GUARD","TUNER","FLEET","LEASE",
      "LOANS","TITLE","TRADE","MODEL","VALUE","PRICE","QUOTE","OFFER","BONUS","SAVES",
      "DEALS","SALES","OWNER","POWER","FIXED","PARTS","PAINT","WELDS","TOOLS","TORCH",
      "METAL","FRAME","CLIPS","WIRES","HOSES","BELTS","PUMPS","CLEAN","SCRUB","TOWED",
      "TOWEL","WAXED","SHINE","BOATS","CANOE","KAYAK","OCEAN","RIVER","SHORE","BEACH",
      "HULLS","ROPES","CLEAT","WINCH","FLOAT","WATER","WAVES","TIDES","SWIMS","FISHY",
      "LURES","REELS","HOOKS","BAITS","CATCH","STERN","BOWED","DOCKS","WHARF","RIDER",
      "DUSTY","DUNES","TRAIL","TRACK","RALLY","CHAIN","GLOVE","HELMS","SUITS","ROLLS",
      "JUMPS","FLEET","DAILY","CHECK","READY","MILES","ROADS","TRIPS","VISIT","LOCAL",
      "RIDES","SALES","DEALS","BONUS","VALUE","PRICE","OFFER","QUOTE","TRADE","LEASE",
      "LOANS","MODEL","STOCK","ORDER","TITLE","TAXES","FEES","COSTS","BUYER","RATES",
      "TERMS","TRUST","SERVE","CARES","GUIDE","MEETS","HAPPY","SMILE","HONOR","PROUD",
      "SUNNY","CLOUD","STORM","WINDS","RAINY","CLEAR","BRISK","CHILL","SNOWY","ICING",
      "FROST","WETLY","DRYER","MOIST","HAZY","GUSTS","HEATS","HOTLY","HUMID","ROADS",
      "ROUTE","NORTH","SOUTH","EASTS","WESTS","HILLS","RIDGE","RIVER","PLAZA","TOWNS",
      "CITIES","RURAL","URBAN","LOCAL","METRO","STATE","PATHS","RANCH","VALVE","SPARK",
      "FIRES","TUNED","OILED","OILER","SHAFT","CRANK","FLUID","MOTOR","WIRES","PIPES",
      "LINES","JOINT","LEVER","BOOST","TURBO","FUMES","SMOKE","BLADE","SUNNY","LAKES",
      "PONDS","WATER","WAVES","BEACH","TIDES","SAILS","CREST","BOARD","BOATS","SHIPS",
      "DOCKS","WHARF","OCEAN","SHORE","COVE","STORM","SWIMS","FLOAT","HONDA","ACURA",
      "MITSU","CIVIC","PILOT","RIDGE","FORCE","RODEO","DRIVE","POWER","SPEED","RALLY",
      "TRACK","SHIFT","BRAKE","TIRES","GRIPS","RACES","DRAGS","STUNT","RIDER","CHASE",
      "MOTOR","BOOST","TURBO","DRIFT","SMILE","HAPPY","TRUST","HONOR","THANK","PROUD",
      "TEAMS","SERVE","HELPS","READY","CARES","GUIDE","MEETS","VALUE","BONUS","FAIRS",
      "CLEAR","BRITE","BRAVE","LOANS","LEASE","TERMS","RATES","FEES","TAXES","COSTS",
      "PRICE","VALUE","BONUS","DEALS","FUNDS","MONEY","CHECK","ORDER","STOCK","CLAIM",
      "APPLY","SCORE","BUYER","ALIGN","CLEAN","READY","FIXED","LOCAL","VISIT","TESTS",
      "SHIFT","RIDES","MOTOR","FLUID","SPARK","SMOKE","DRYER","SHINE","BOOST","DRIFT",
      "TRIPS","ROADS","NORTH","SOUTH","EASTS","WESTS","STATE","METRO","URBAN","RURAL",
      "RIVER","TRAIL","TRADE","MODEL","PILOT","CIVIC","ACURA","HONDA","MITSU","OWNER",
      "POWER","SPEED","SHIFT","DRIVE","RIDGE","BEACH","WAVES","WATER","FLOAT","FISHY",
      "CATCH","REELS","HOOKS","BOATS","LAKES","SHORE","RANGE","RIDER","HELMS","BRISK",
      "SUNNY","CLOUD","STORM","CLEAR","CLEAN","READY","SMILE"
    ];

    // --- Daily word + one-game-per-day helpers ---

    const VERDLE_LAST_PLAYED_KEY = "verdleLastPlayedDay";

    // Safer "day index" that avoids timezone/MS quirks: YYYYMMDD as integer
    function getDayIndex() {
      const d = new Date();
      const y = d.getFullYear();
      const m = d.getMonth() + 1; // 1â€“12
      const day = d.getDate();    // 1â€“31
      return y * 10000 + m * 100 + day; // e.g. 20251125
    }

    // localStorage safety (Safari private mode etc.)
    let verdleStorageOK = true;
    try {
      localStorage.setItem("__verdle_test", "1");
      localStorage.removeItem("__verdle_test");
    } catch (e) {
      verdleStorageOK = false;
    }

    function hasPlayedToday() {
      if (!verdleStorageOK) return false;
      const stored = localStorage.getItem(VERDLE_LAST_PLAYED_KEY);
      const todayStr = String(getDayIndex());
      return stored === todayStr;
    }

    function markPlayedToday() {
      if (!verdleStorageOK) return;
      const todayStr = String(getDayIndex());
      localStorage.setItem(VERDLE_LAST_PLAYED_KEY, todayStr);
    }

    function getDailyWord() {
      const index = getDayIndex() % VERN_EIDE_WORDS.length;
      return VERN_EIDE_WORDS[index];
    }

    let solution = "";
    let currentRow = 0;
    let currentCol = 0;
    let gameOver = false;

    function initGame() {
      solution = getDailyWord();
      currentRow = 0;
      currentCol = 0;
      gameOver = false;
      clearBoard();

      const resetBtn = document.getElementById("resetBtn");

      if (hasPlayedToday()) {
        gameOver = true;
        setMessage("You already played Verdle today. Come back tomorrow!");
        if (resetBtn) resetBtn.disabled = true;
      } else {
        setMessage("Type any 5 letters and press Enter.");
        if (resetBtn) resetBtn.disabled = false;
        focusHiddenInput();
      }
      // console.log("Solution:", solution); // uncomment to peek
    }

    function clearBoard() {
      for (let r = 0; r < MAX_GUESSES; r++) {
        for (let c = 0; c < WORD_LENGTH; c++) {
          const tile = getTile(r, c);
          tile.textContent = "";
          tile.className = "tile"; // reset classes
        }
      }
    }

    function getTile(row, col) {
      return document.getElementById(`tile-${row}-${col}`);
    }

    function setMessage(msg) {
      document.getElementById("message").textContent = msg;
    }

    // Core key-handling logic shared by desktop + mobile
    function handleKey(key) {
      if (gameOver) return;

      if (key === "Enter") {
        if (currentCol === WORD_LENGTH) {
          submitGuess();
        } else {
          setMessage("Not enough letters.");
        }
      } else if (key === "Backspace") {
        if (currentCol > 0) {
          currentCol--;
          const tile = getTile(currentRow, currentCol);
          tile.textContent = "";
          tile.classList.remove("filled");
        }
      } else if (/^[a-zA-Z]$/.test(key)) {
        if (currentCol < WORD_LENGTH) {
          const tile = getTile(currentRow, currentCol);
          tile.textContent = key.toUpperCase();
          tile.classList.add("filled");
          currentCol++;
        }
      }
    }

    // Desktop / hardware keyboard
    function handleKeyDown(e) {
      handleKey(e.key);
    }

    function submitGuess() {
      // Build the guess string from the current row
      let guess = "";
      for (let c = 0; c < WORD_LENGTH; c++) {
        guess += getTile(currentRow, c).textContent;
      }

      const result = evaluateGuess(guess, solution);

      // Apply colors to tiles
      for (let c = 0; c < WORD_LENGTH; c++) {
        const tile = getTile(currentRow, c);
        tile.classList.remove("correct", "present", "absent");
        tile.classList.add(result[c]);
      }

      const resetBtn = document.getElementById("resetBtn");

      if (guess === solution) {
        setMessage("You got it! ðŸŽ‰");
        gameOver = true;
        markPlayedToday();
        if (resetBtn) resetBtn.disabled = true; // optional
        return;
      }

      currentRow++;
      currentCol = 0;

      if (currentRow === MAX_GUESSES) {
        setMessage(`Out of guesses! The word was ${solution}.`);
        gameOver = true;
        markPlayedToday();
        if (resetBtn) resetBtn.disabled = true; // optional
      } else {
        setMessage("Keep going!");
      }
    }

    // Returns array of "correct", "present", "absent" for each letter
    function evaluateGuess(guess, solution) {
      const result = new Array(WORD_LENGTH).fill("absent");
      const solutionCounts = {};

      // First pass: mark correct and count remaining letters in solution
      for (let i = 0; i < WORD_LENGTH; i++) {
        const sChar = solution[i];
        const gChar = guess[i];

        if (gChar === sChar) {
          result[i] = "correct";
        } else {
          solutionCounts[sChar] = (solutionCounts[sChar] || 0) + 1;
        }
      }

      // Second pass: mark present letters using remaining counts
      for (let i = 0; i < WORD_LENGTH; i++) {
        const gChar = guess[i];

        if (result[i] === "correct") continue;

        if (solutionCounts[gChar] > 0) {
          result[i] = "present";
          solutionCounts[gChar]--;
        } else {
          result[i] = "absent";
        }
      }

      return result;
    }

    // Mobile keyboard support via hidden input
    const hiddenInput = document.getElementById("hiddenInput");

    function focusHiddenInput() {
      if (hiddenInput) {
        hiddenInput.focus();
      }
    }

    // When the user types into the hidden input (Android/iOS), feed characters into handleKey
    if (hiddenInput) {
      hiddenInput.addEventListener("input", (e) => {
        const value = e.target.value;
        if (!value) return;

        const char = value[value.length - 1];
        e.target.value = "";

        // Only letters go through here; Enter/Backspace come from keydown usually
        handleKey(char);
      });
    }

    // Re-focus the hidden input when the user taps anywhere
    document.addEventListener("click", focusHiddenInput);
    document.addEventListener("touchstart", focusHiddenInput, { passive: true });

    document.addEventListener("keydown", handleKeyDown);
    document.getElementById("resetBtn").addEventListener("click", initGame);

    // Initial setup
    window.addEventListener("load", () => {
      initGame();
      focusHiddenInput();
    });
  </script>
</body>
</html>
